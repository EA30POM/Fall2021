<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2021-11-30" />

<title>Soil science analyses</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Environmental Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data science
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 1</li>
    <li>
      <a href="Rintro.html">The R and RStudio environments</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Climate science
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 1</li>
    <li>
      <a href="AQintro.html">Air Quality Lab Introduction</a>
    </li>
    <li class="dropdown-header">Week 2</li>
    <li>
      <a href="AQexp1.html">Air Quality: Test transects</a>
    </li>
    <li class="dropdown-header">Week 3</li>
    <li>
      <a href="AQexp2.html">Air Quality: Analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Soil science
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="soil.html">Analyzing data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Environmental communications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="EnvComm1.html">Visualization</a>
    </li>
    <li>
      <a href="EnvComm2.html">Analysis</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Groups</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="Group1.html">Group1</a>
        </li>
        <li>
          <a href="Group2.html">Group2</a>
        </li>
        <li>
          <a href="Group3.html">Group3</a>
        </li>
        <li>
          <a href="Group4.html">Group4</a>
        </li>
        <li>
          <a href="Group5.html">Group5</a>
        </li>
        <li>
          <a href="Group6.html">Group6</a>
        </li>
      </ul>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Soil science analyses</h1>
<h4 class="author"></h4>
<h4 class="date">2021-11-30</h4>

</div>


<div id="overview" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Overview</h1>
<p>This page provides a demonstration on using <code>R</code> and shuffling our data to analyze your soil science hypotheses to generate figures and results for your poster presentation. You are welcome to either follow along with the text and copy-paste the code into the console <strong>or</strong> read through and then copy the whole script into a new <code>R</code> script in <a href="https://rstudio.cloud/spaces/170230/project/3124212">Rstudio.cloud</a>. <strong>Please make sure that you start a new project using that link.</strong> Do <strong>not</strong> continue using the projects from the Air Quality Lab.</p>
<p>This table below shows the hypotheses for each group:</p>
<table>
<colgroup>
<col width="17%" />
<col width="33%" />
<col width="33%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th>Group</th>
<th>Hypothesis</th>
<th>Variables</th>
<th>Statistic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Do drought-deciduous plants store more <code>C</code> and <code>N</code>?</td>
<td><code>Cperc</code>, <code>Nperc</code>, <code>PlantComm</code> or <code>CSS</code></td>
<td>Difference in means</td>
</tr>
<tr class="even">
<td>2</td>
<td>Is F:B positively correlated with SOM?</td>
<td><code>FBratio</code>, <code>SOM</code></td>
<td>Correlation coefficient</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Do woody plants have higher microbial biomass?</td>
<td><code>Microbes</code>, <code>PlantComm</code> or <code>CSS</code></td>
<td>Difference in means</td>
</tr>
<tr class="even">
<td>4</td>
<td>Is soil density positively correlated with total carbon levels?</td>
<td><code>SoilDensity</code>, <code>soilC</code></td>
<td>Correlation coefficient</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Is F:B correlated with C and N quantity?</td>
<td><code>FBratio</code>, <code>soilC</code>, variable you will have to create (see <code>soilC</code> for an example)</td>
<td>Regression model (<code>lm</code>) or correlation coefficients</td>
</tr>
<tr class="even">
<td>6</td>
<td>Is soil organic matter higher in Coastal Sage Scrub plants?</td>
<td><code>SOM</code> and <code>PlantComm</code> or <code>CSS</code></td>
<td>Difference in means</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Is there a negative correlation between rock mass and N quantity?</td>
<td>Modify <code>soilC</code> to calculate <code>soilN</code> and use <code>RockWeightG</code></td>
<td>Correlation coefficient</td>
</tr>
</tbody>
</table>
</div>
<div id="preparing-data" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Preparing data</h1>
<div id="load-packages" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> 1: Load packages</h2>
<p>Below, we will start by loading packages that we’ll need.</p>
<pre class="r"><code>### Load packages
library(&quot;ggplot2&quot;) # plotting functions
library(&quot;dplyr&quot;) # data wrangling functions
library(&quot;readr&quot;) # reading in tables, including ones online
library(&quot;mosaic&quot;) # shuffle (permute) our data</code></pre>
</div>
<div id="read-data" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> 2: Read data</h2>
<p>Next, we will pull in our data and start creating some useful variables, such as <code>SoilDensity</code>, the density of the soil (units: g/mL), or <code>soilC</code>, the quantity of carbon in the soil given its density.</p>
<pre class="r"><code>### Load in dataset
soilDF &lt;- readr::read_tsv(&quot;https://raw.githubusercontent.com/EA30POM/Fall2021/main/data/soilFullData.tsv&quot;) # read in spreadsheet from its URL and store in soilDF

### Preparing data
soilDF$CSS &lt;- as.factor(soilDF$CSS) # convert 0 and 1 for CSS (coastal sage scrub) from numeric to categorical (&quot;factor&quot;)

soilDF &lt;- soilDF %&gt;% # take soilDF object and feed it into --&gt;
  mutate(PlantComm = ifelse(CSS==&quot;1&quot;,&quot;CSS&quot;,&quot;CHAP&quot;)) # use mutate to create a new column that has two types of plant communities: CSS and CHAP(arral)

### Calculate useful variables
soilDF &lt;- soilDF %&gt;% # take soilDF object and feed it into --&gt; 
  mutate(SoilDensity = ( (ClodWeight1dip - (ClodNMinus1/NumAddedDips)) * (1 - (ClodWeightNdips-DriedWt)/ClodWeightNdips) - RockWeightG)/ClodVolumeInmL ) # create SoilDensity variable from columns in the data following Caspi et al. 2019

soilDF &lt;- soilDF %&gt;%
  mutate(soilC = SoilDensity * 10^5 * Cperc/100 * 1/10^3) # create SoilDensity variable, which has these units: kg C/m2 at a depth of 10cm

### Display data
# View(soilDF) # open a spreadsheet viewer
  # delete the leading comment/hashtag sign to run the code above</code></pre>
</div>
<div id="exploratory-data-analysis" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> 3: Exploratory data analysis</h2>
<p>Below, I provide fully-worked examples of different ways of inspecting your data and performing analyses <strong>assuming that <code>SoilDensity</code> is the variable of interest</strong>. In applying this code to your own data, you will want to think about what variable name should <em>replace</em> <code>SoilDensity</code> in the commands below. For example, you would change <code>tapply(soilDF$SoilDensity, soilDF$PlantComm, summary)</code> to <code>tapply(soilDF$ResponseVariable,soilDF$PlantComm, summary)</code> where <code>ResponseVariable</code> is the variable you’re analyzing.</p>
<p>Let’s start with exploratory data analysis where you calculate summary statistics and visualize your variable.</p>
<pre class="r"><code>### Calculate summary statistics for SoilDensity
### for each PlantComm(unity)
tapply(soilDF$SoilDensity, soilDF$PlantComm, summary) </code></pre>
<pre><code>## $CHAP
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.4531  0.8578  0.9913  0.9292  1.1147  1.1691 
## 
## $CSS
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.5908  0.8984  1.0682  1.0580  1.3530  1.4286</code></pre>
<pre class="r"><code>  # use PlantComm as the grouping variable
  # for SoilDensity and then summarize SoilDensity
  # for each PlantComm(unity)</code></pre>
<p>How would I visualize the distribution of values of <code>SoilDensity</code>? I could use a histogram and color the values differently for Coastal Sage Scrub vs. chaparral.</p>
<pre class="r"><code>### Visualize your variable of interest
  # Histogram
gf_histogram(~SoilDensity,              # plot distribution of SoilDensity
             fill=~CSS,                 # change colors based on CSS (or not)
             data=soilDF,               # the data come from the soilDF object
             xlab=&quot;Soil density (g/mL)&quot;,# change the x-axis label
             ylab=&quot;Count&quot;)              # change the y-axis label</code></pre>
<p><img src="soil_files/figure-html/EDAhist-1.png" width="672" /></p>
<p>Alternatively, I could create a boxplot to visualize the distribution of values in <code>SoilDensity</code> with two boxplots for each plant community.</p>
<pre class="r"><code>### Visualize your variable of interest
  # Boxplot
gf_boxplot(SoilDensity~CSS,       # plot distribution of SoilDensity for CSS
       fill= ~CSS,                # change colors based on CSS (or not)
       data=soilDF,               # the data come from the soilDF object
       xlab=&quot;Woody vegetation&quot;,   # change x-axis label
       ylab=&quot;Soil density (g/mL)&quot;)# change y-axis label</code></pre>
<p><img src="soil_files/figure-html/EDAbox-1.png" width="672" /></p>
<p>Finally, if I am interested in the relationship between two or more variables, I can use a scatterplot to visualize each pair of data.</p>
<pre class="r"><code>### Visualization
  # Scatterplot
gf_point(SoilDensity~Species,        # plot SoilDensity against plant Species
         color= ~CSS,                # change colors based on CSS (or not)
         data= soilDF,               # the data come from the soilDF object
         xlab=&quot;Species&quot;,             # change x-axis label
         ylab=&quot;Soil density (g/mL)&quot;) # change y-axis label</code></pre>
<p><img src="soil_files/figure-html/scatter-1.png" width="672" /></p>
</div>
</div>
<div id="analysis" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Analysis</h1>
<p>The code below shows you how to do different types of analyses.</p>
<div id="calculating-differences-in-means" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> 1: Calculating differences in means</h2>
<p>Let’s say I am interested in determining <code>if Coastal Sage Scrub (CSS) plants tend to have higher soil density than Chaparral (CHAP) plants</code>. This sounds like I want to see if there is a clear difference in the mean values of <code>SoilDensity</code> for the CSS plants versus the CHAP plants. We can start by calculating the mean difference we observe.</p>
<pre class="r"><code>mean( SoilDensity ~ PlantComm, data = soilDF , na.rm=T) # show mean SoilDensity values for the plant communities and remove missing data</code></pre>
<pre><code>##      CHAP       CSS 
## 0.9291509 1.0580391</code></pre>
<pre class="r"><code>obs_diff &lt;- diff( mean( SoilDensity ~ PlantComm, data = soilDF , na.rm=T)) # calculate the difference between the means and store in a variable called &quot;obs_diff&quot;
obs_diff # display the value of obs_diff</code></pre>
<pre><code>##       CSS 
## 0.1288881</code></pre>
<p>OK, so the mean difference in mean soil density between CSS and CHAP is 0.13. Are the plant communities meaningfully different in terms of soil density though? Our null hypothesis would be that there is no difference in soil density between the plant communities.</p>
<p>Logically, if there is a meaningful difference, then if we shuffle our data around, that should lead to different results than what we see. That is one way to <em>simulate</em> statistics to test the null hypothesis. And specifically, in this case, we would expect to see our observed difference is much larger than most of the simulated values.</p>
<p>What does simulating our data look like?</p>
<p>Well, here is what the data look like initially:</p>
<pre class="r"><code>soilDF[,c(1:4,19:21)]</code></pre>
<pre><code>## # A tibble: 28 x 7
##    SampleID Species Group CSS   PlantComm SoilDensity soilC
##    &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
##  1 Artcal1  Artcal      1 1     CSS             1.33  2.20 
##  2 Mallau1  Mallau      1 0     CHAP            1.08  2.64 
##  3 Salapi1  Salapi      1 1     CSS             1.39  2.37 
##  4 Samnig1  Samnig      1 0     CHAP            0.852 0.801
##  5 Artcal2  Artcal      2 1     CSS             0.946 7.26 
##  6 Mallau2  Mallau      2 0     CHAP            0.473 2.05 
##  7 Salapi2  Salapi      2 1     CSS             1.06  1.88 
##  8 Samnig2  Samnig      2 0     CHAP            1.16  2.19 
##  9 Artcal3  Artcal      3 1     CSS             0.691 1.57 
## 10 Mallau3  Mallau      3 0     CHAP            0.453 9.47 
## # … with 18 more rows</code></pre>
<p>Here is what it looks like after we’ve “shuffled” it once by randomizing the <code>PlantComm</code> assignments. This is like taking a deck of cards with different <code>SoilDensity</code> or <code>SoilC</code>(arbon) values, and being able to change their color and suite (in this case, plant community associated with that card).</p>
<pre class="r"><code>resample(soilDF[,c(1:4,19:21)],groups=PlantComm,shuffled=c(&quot;SoilDensity&quot;,&quot;soilC&quot;))</code></pre>
<pre><code>## # A tibble: 28 x 8
##    SampleID Species Group CSS   PlantComm SoilDensity soilC orig.id 
##    &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
##  1 Mallau6  Mallau      6 0     CHAP            0.901 3.36  22.28.28
##  2 Mallau4  Mallau      4 0     CHAP            1.08  2.72  14.2.24 
##  3 Mallau4  Mallau      4 0     CHAP            1.08  2.48  14.24.18
##  4 Samnig6  Samnig      6 0     CHAP            0.955 0.801 24.22.4 
##  5 Mallau5  Mallau      5 0     CHAP            0.875 2.48  18.14.18
##  6 Samnig1  Samnig      1 0     CHAP            0.453 9.47  4.10.10 
##  7 Mallau5  Mallau      5 0     CHAP            1.08  2.51  18.24.14
##  8 Samnig7  Samnig      7 0     CHAP            1.17  0.554 28.18.22
##  9 Samnig5  Samnig      5 0     CHAP            0.852 2.64  20.4.2  
## 10 Mallau3  Mallau      3 0     CHAP            0.453 2.51  10.10.14
## # … with 18 more rows</code></pre>
<p>We can repeat that procedure again and see how the data shifts when we do another shuffle.</p>
<pre class="r"><code>resample(soilDF[,c(1:4,19:21)],groups=PlantComm,shuffled=c(&quot;SoilDensity&quot;,&quot;soilC&quot;))</code></pre>
<pre><code>## # A tibble: 28 x 8
##    SampleID Species Group CSS   PlantComm SoilDensity soilC orig.id 
##    &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
##  1 Samnig4  Samnig      4 0     CHAP            0.852 9.47  16.4.10 
##  2 Samnig3  Samnig      3 0     CHAP            1.13  0.801 12.26.4 
##  3 Mallau7  Mallau      7 0     CHAP            0.852 2.72  26.4.24 
##  4 Samnig1  Samnig      1 0     CHAP            0.716 0.801 4.12.4  
##  5 Samnig3  Samnig      3 0     CHAP            0.716 2.51  12.12.26
##  6 Samnig4  Samnig      4 0     CHAP            0.716 6.64  16.12.12
##  7 Samnig1  Samnig      1 0     CHAP            1.03  0.801 4.16.4  
##  8 Samnig6  Samnig      6 0     CHAP            0.852 0.801 24.4.4  
##  9 Samnig1  Samnig      1 0     CHAP            1.03  6.64  4.16.12 
## 10 Samnig1  Samnig      1 0     CHAP            0.852 6.64  4.4.12  
## # … with 18 more rows</code></pre>
<p>Let’s shuffle the data and see what that means for the distribution of mean <code>SoilDensity</code> differences between <code>CSS</code> and <code>CHAP</code>.</p>
<pre class="r"><code>### Create random differences by shuffling the data
randomizing_diffs &lt;- do(1000) * diff( mean( SoilDensity ~ shuffle(PlantComm),na.rm=T, data = soilDF) ) # calculate the mean in SoilDensity when we&#39;re shuffling the plant community around 1000 times
  # Clean up our shuffled data
names(randomizing_diffs)[1] &lt;- &quot;DiffMeans&quot; # change the name of the variable

# View first few rows of data
head(randomizing_diffs)</code></pre>
<pre><code>##     DiffMeans
## 1 -0.13261329
## 2 -0.11883809
## 3 -0.12149048
## 4  0.06824462
## 5 -0.10695182
## 6 -0.06327423</code></pre>
<p>Now we can visualize the distribution of simulated differences in mean soil density and our observed difference between CSS and CHAP.</p>
<pre class="r"><code>gf_histogram(~ DiffMeans, fill = ~ (DiffMeans &gt;= obs_diff),
             data = randomizing_diffs,
             xlab=&quot;Difference in mean soil density under null&quot;,
             ylab=&quot;Count&quot;)</code></pre>
<p><img src="soil_files/figure-html/diffHist-1.png" width="672" /></p>
<p>In the end, how many of the simulated mean differences were larger than the value we observed? Based on this value, if we were using the conventional <span class="math inline">\(p\)</span>-value (probability value) of 0.05, we would conclude that because this simulated <span class="math inline">\(p\)</span>-value &gt; 0.05, that we cannot reject the null hypothesis.</p>
<pre class="r"><code># What proportion of simulated values were larger than our observed difference
prop( ~ DiffMeans &gt;= 0.142, data = randomizing_diffs) # 0.142 was the observed difference value - see obs_diff</code></pre>
<pre><code>## prop_TRUE 
##     0.082</code></pre>
</div>
<div id="calculating-correlation-coefficients" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> 2: Calculating correlation coefficients</h2>
<p>How would I determine if there is a non-zero correlation between two variables or that two variables are positively correlated? I can again start by calculating the observed correlation coefficient for the data.</p>
<pre class="r"><code>### Calculate observed correlation
obs_cor &lt;- cor(BacterialPerc ~ SoilDensity, data=soilDF, use=&quot;complete.obs&quot;) # store observed correlation in obs_cor of BacterialPerc vs. SoilDensity
obs_cor # print out value</code></pre>
<pre><code>## [1] -0.01111519</code></pre>
<p>Let’s say that I’m interested in determining if the percentage of bacteria is negatively correlated with soil density. Our null hypothesis could be that the correlation coefficient is actually 0. As before though, how do I know that my correlation coefficient of 0 is significantly different from 0? We can tackle this question by simulating a ton of correlation coefficient values from our data by shuffling it!</p>
<p>In this case, the shuffling here lets us estimate the variation in the correlation coefficient given our data. So we are curious now if the distribution of simulated values does or does not include 0 (that is, is it clearly <span class="math inline">\(&lt; 0\)</span> or <span class="math inline">\(&gt; 0\)</span>?).</p>
<pre class="r"><code>### Calculate correlation coefs for shuffled data
randomizing_cor &lt;- do(1000) * cor(BacterialPerc ~ SoilDensity, 
                                 data = resample(soilDF), 
                                 use=&quot;complete.obs&quot;) 
# Shuffle the data 1000 times
# Calculate the correlation coefficient each time
# By correlating BacterialPerc to SoilDensity from the
# data object soilDF</code></pre>
<p>What are the distribution of correlation coefficients that we see when we shuffle our data?</p>
<pre class="r"><code>quantiles_cor &lt;- qdata( ~ cor, p = c(0.025, 0.975), data=randomizing_cor) # calculate the 2.5% and 97.5% quantiles in our simulated correlation coefficient data (note that 97.5-2.5 = 95!)
quantiles_cor # display the quantiles</code></pre>
<pre><code>##       2.5%      97.5% 
## -0.3850115  0.4429795</code></pre>
<p>The values above give us a 95% confidence interval estimate for our correlation coefficient!</p>
<p>Do we clearly see that our correlation coefficient distribution does or doesn’t include 0?</p>
<pre class="r"><code>gf_histogram(~ cor,
             data = randomizing_cor,
             xlab=&quot;Simulated correlation coefficients&quot;,
             ylab=&quot;Count&quot;)</code></pre>
<p><img src="soil_files/figure-html/simCorHist-1.png" width="672" /></p>
<p>In this case, our simulated correlation coefficient includes 0 in its 95% simulated confidence interval. We can also see this in the plot. So given these data, we cannot reject the null hypothesis. There is not sufficiently strong data that percent bacteria associates with soil density in any clear way.</p>
</div>
<div id="performing-a-regression-model" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> 3: Performing a regression model</h2>
<p>The last type of analysis we’ll look at is a regression model. Specifically, we’ll do an analysis with two predictor variables. We are evaluating how soil density covaries with percent bacteria and the weight of 2-3 resin dips (<code>ClodNMinus1</code>).</p>
<p>We can see how our response variable co-varies with each predictor variable by using scatterplots. Here we can also add a line for each pair of variables.</p>
<pre class="r"><code>gf_point(SoilDensity ~ BacterialPerc,    # plot soil density against bacteria
         data=soilDF,                    # from the soilDF data
         xlab=&quot;Bacteria %&quot;,              # change x-axis label
         ylab=&quot;Soil density (g/mL)&quot;) %&gt;% # change y-axis label
  gf_lm()                                # add a regression line for these two variables only</code></pre>
<p><img src="soil_files/figure-html/biplot-1.png" width="672" /></p>
<p>Now let’s run a linear regression for multiple predictor variables (multiple regression).</p>
<pre class="r"><code>lm_mod &lt;- lm(SoilDensity ~ BacterialPerc + ClodNMinus1, data=soilDF) # perform linear regression of soil density against bacterial percentage and resin weight and store in an object called lm_mod
lm_mod # print object</code></pre>
<pre><code>## 
## Call:
## lm(formula = SoilDensity ~ BacterialPerc + ClodNMinus1, data = soilDF)
## 
## Coefficients:
##   (Intercept)  BacterialPerc    ClodNMinus1  
##      1.024700       0.001395      -0.072026</code></pre>
<p>We can also shuffle our data to estimate the variation in the coefficient values. Our null is that the coefficient estimates are equal to 0. That is, there is no relationship between soil density and bacterial percentage or resin dip weight. If the simulated coefficient estimates have an interval that doesn’t cross 0 (go from negative to positive), then that is evidence against the null hypothesis.</p>
<pre class="r"><code>lm_boot &lt;- do(1000) * lm(SoilDensity ~ BacterialPerc + ClodNMinus1, data=resample(soilDF)) # shuffle our data 1000 times and re-run the linear model each time and store the outputs in lm_boot
confint(lm_boot) # generate a 95% confidence interval from the simulated values for the linear regression coefficients</code></pre>
<pre><code>##            name        lower        upper level     method     estimate
## 1     Intercept  0.438163749  1.448689039  0.95 percentile  1.024699637
## 2 BacterialPerc -0.004041373  0.008190237  0.95 percentile  0.001395041
## 3   ClodNMinus1 -0.111839871 -0.040983250  0.95 percentile -0.072025910
## 4         sigma  0.147386791  0.253870428  0.95 percentile  0.215825625
## 5     r.squared  0.160320095  0.682881677  0.95 percentile  0.408701398
## 6             F  2.386625357 26.917467176  0.95 percentile  8.639911321</code></pre>
<p>Based on the values above, as clod resin weight increases by one gram, soil density decreases by as much as 0.11 grams and as little as 0.015 grams. On the other hand, it looks like bacterial percentage does not have a clear directional effect on soil density.</p>
</div>
</div>
<div id="code-in-entirety" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Code in entirety</h1>
<p>The segment below can be directly copied and pasted into the code editor in RStudio Cloud.</p>
<pre class="r"><code>###=========================================
### Load packages
###=========================================

library(&quot;ggplot2&quot;) # plotting functions
library(&quot;dplyr&quot;) # data wrangling functions
library(&quot;readr&quot;) # reading in tables, including ones online
library(&quot;mosaic&quot;) # shuffle (permute) our data

###=========================================
### Load and process data
###=========================================

### Load in dataset
soilDF &lt;- readr::read_tsv(&quot;https://raw.githubusercontent.com/EA30POM/Fall2021/main/data/soilFullData.tsv&quot;) # read in spreadsheet from its URL and store in soilDF

### Preparing data
soilDF$CSS &lt;- as.factor(soilDF$CSS) # convert 0 and 1 for CSS (coastal sage scrub) from numeric to categorical (&quot;factor&quot;)

soilDF &lt;- soilDF %&gt;% # take soilDF object and feed it into --&gt;
  mutate(PlantComm = ifelse(CSS==&quot;1&quot;,&quot;CSS&quot;,&quot;CHAP&quot;)) # use mutate to create a new column that has two types of plant communities: CSS and CHAP(arral)

### Calculate useful variables
soilDF &lt;- soilDF %&gt;% # take soilDF object and feed it into --&gt; 
  mutate(SoilDensity = ( (ClodWeight1dip - (ClodNMinus1/NumAddedDips)) * (1 - (ClodWeightNdips-DriedWt)/ClodWeightNdips) - RockWeightG)/ClodVolumeInmL ) # create SoilDensity variable from columns in the data following Caspi et al. 2019

soilDF &lt;- soilDF %&gt;%
  mutate(soilC = SoilDensity * 10^5 * Cperc/100 * 1/10^3) # create SoilDensity variable, which has these units: kg C/m2 at a depth of 10cm

### Display data
View(soilDF) # open a spreadsheet viewer

###=========================================
### Exploratory data analysis
###=========================================

### Calculate summary statistics for SoilDensity
### for each PlantComm(unity)
tapply(soilDF$SoilDensity, soilDF$PlantComm, summary) 
  # use PlantComm as the grouping variable
  # for SoilDensity and then summarize SoilDensity
  # for each PlantComm(unity)

### Visualize your variable of interest
  # Histogram
gf_histogram(~SoilDensity,              # plot distribution of SoilDensity
             fill=~CSS,                 # change colors based on CSS (or not)
             data=soilDF,               # the data come from the soilDF object
             xlab=&quot;Soil density (g/mL)&quot;,# change the x-axis label
             ylab=&quot;Count&quot;)              # change the y-axis label

### Visualize your variable of interest
  # Boxplot
gf_boxplot(SoilDensity~CSS,       # plot distribution of SoilDensity for CSS
       fill= ~CSS,                # change colors based on CSS (or not)
       data=soilDF,               # the data come from the soilDF object
       xlab=&quot;Woody vegetation&quot;,   # change x-axis label
       ylab=&quot;Soil density (g/mL)&quot;)# change y-axis label

### Visualization
  # Scatterplot
gf_point(SoilDensity~Species,        # plot SoilDensity against plant Species
         color= ~CSS,                # change colors based on CSS (or not)
         data= soilDF,               # the data come from the soilDF object
         xlab=&quot;Species&quot;,             # change x-axis label
         ylab=&quot;Soil density (g/mL)&quot;) # change y-axis label

###=========================================
### Analysis - Differences in means
###=========================================

mean( SoilDensity ~ PlantComm, data = soilDF , na.rm=T) # show mean SoilDensity values for the plant communities and remove missing data
obs_diff &lt;- diff( mean( SoilDensity ~ PlantComm, data = soilDF , na.rm=T)) # calculate the difference between the means and store in a variable called &quot;obs_diff&quot;
obs_diff # display the value of obs_diff

### Create random differences by shuffling the data
randomizing_diffs &lt;- do(1000) * diff( mean( SoilDensity ~ shuffle(PlantComm),na.rm=T, data = soilDF) ) # calculate the mean in SoilDensity when we&#39;re shuffling the plant community around 1000 times
  # Clean up our shuffled data
names(randomizing_diffs)[1] &lt;- &quot;DiffMeans&quot; # change the name of the variable

# View first few rows of data
head(randomizing_diffs)

gf_histogram(~ DiffMeans, fill = ~ (DiffMeans &gt;= obs_diff),
             data = randomizing_diffs,
             xlab=&quot;Difference in mean soil density under null&quot;,
             ylab=&quot;Count&quot;)

###=========================================
### Analysis - Correlation coefficient
###=========================================

### Calculate observed correlation
obs_cor &lt;- cor(BacterialPerc ~ SoilDensity, data=soilDF, use=&quot;complete.obs&quot;) # store observed correlation in obs_cor of BacterialPerc vs. SoilDensity
obs_cor # print out value

### Calculate correlation coefs for shuffled data
randomizing_cor &lt;- do(1000) * cor(BacterialPerc ~ SoilDensity, 
                                 data = resample(soilDF), 
                                 use=&quot;complete.obs&quot;) 
# Shuffle the data 1000 times
# Calculate the correlation coefficient each time
# By correlating BacterialPerc to SoilDensity from the
# data object soilDF

quantiles_cor &lt;- qdata( ~ cor, p = c(0.025, 0.975), data=randomizing_cor) # calculate the 2.5% and 97.5% quantiles in our simulated correlation coefficient data (note that 97.5-2.5 = 95!)
quantiles_cor # display the quantiles

gf_histogram(~ cor, fill = ~ (cor &gt; 0),
             data = randomizing_cor,
             xlab=&quot;Simulated correlation coefficients&quot;,
             ylab=&quot;Count&quot;)

###=========================================
### Analysis - Linear regression
###=========================================
### Initial visualization
gf_point(SoilDensity ~ BacterialPerc,    # plot soil density against bacteria
         data=soilDF,                    # from the soilDF data
         xlab=&quot;Bacteria %&quot;,              # change x-axis label
         ylab=&quot;Soil density (g/mL)&quot;) %&gt;% # change y-axis label
  gf_lm()                                # add a regression line for these two variables only

lm_mod &lt;- lm(SoilDensity ~ BacterialPerc + ClodNMinus1, data=soilDF) # perform linear regression of soil density against bacterial percentage and resin weight and store in an object called lm_mod
lm_mod # print object

lm_boot &lt;- do(1000) * lm(SoilDensity ~ BacterialPerc + ClodNMinus1, data=resample(soilDF)) # shuffle our data 1000 times and re-run the linear model each time and store the outputs in lm_boot
confint(lm_boot) # generate a 95% confidence interval from the simulated values for the linear regression coefficients</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
