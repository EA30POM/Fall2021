<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="" />

<meta name="date" content="2021-09-09" />

<title>Air quality lab: Week 2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Environmental Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data science
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 1</li>
    <li>
      <a href="Rintro.html">The R and RStudio environments</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Climate science
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 1</li>
    <li>
      <a href="AQintro.html">Air Quality Lab Introduction</a>
    </li>
    <li class="dropdown-header">Week 2</li>
    <li>
      <a href="AQexp1.html">Running transects</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Air quality lab: Week 2</h1>
<h4 class="date">2021-09-09</h4>

</div>


<div id="week-2-lab-overview" class="section level1">
<h1>Week 2 Lab Overview</h1>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
<p>In lab this week, we will perform the following:</p>
<ul>
<li>collect data from PL Air sensors along transects;</li>
<li>revisit and enhance community guidelines to also incorporate field safety;</li>
<li>develop questions as PL Air groups to explore.</li>
</ul>
<p>Time permitting, we may also take on the following tasks:</p>
<ul>
<li>viewing and interacting with the PL Air data from week 1 in <code>R</code> using RStudio Server.</li>
</ul>
<p>We are working toward the <a href="https://docs.google.com/document/d/1cDigyPgzX_VSvtFfDfsixEAhBH2nnJbTyl-WXdDUm2k/edit?usp=sharing">climate/air quality group report described here</a>.</p>
</div>
<div id="designing-environmental-data-collection" class="section level2">
<h2>Designing environmental data collection</h2>
<p>One ubiquitous method of field sampling is the transect sampling method. For transect sampling, one typically takes data at specific, equally-spaced locations along a gradient or across (micro)habitats. For one example of transect sampling air pollution, please see this <a href="https://publiclab.org/notes/sarasage/08-09-2021/choosing-locations-and-methodology-for-air-quality-gas-testing">Public Lab write up</a> and/or this <a href="https://insideecology.com/2018/09/11/the-ecology-of-air-pollution/">Inside Ecology write up</a>. This is also a form of systematic sampling, as you would be taking measurements at locations based on a fixed pattern. For more background on sampling procedures and guidance on one way to think through sampling design, please visit this <a href="https://web.njit.edu/~kebbekus/analysis/SAMPLING.htm">Environmental Chemical Analysis site</a>. Note that not all of the examples there are relevant (e.g. biodiversity sampling, soil sampling), but the general principles in Sections 2.1, 2.2 (our sample is more akin to a “grab sample”), and 2.4 are pertinent.</p>
</div>
</div>
<div id="lab-steps" class="section level1">
<h1>Lab steps</h1>
<div id="taking-data-with-your-pl-air-teams" class="section level2">
<h2>Taking data with your PL Air teams</h2>
<ul>
<li>Note that you can always see who is in your group by navigating to the <a href="https://sakai.claremont.edu/portal/directtool/53e2629b-e3ca-49ab-bf71-4b5a9f4e535a/">Roster sub-page</a> on Sakai then going to <strong>Group</strong> and selecting your group’s name.</li>
<li>With your groups, you will select an initial location to test out running a transect with your PL Air units.
<ul>
<li>I strongly recommend bringing a notebook and having one member of the team act as a timer. The timer (or another member) can also keep track of your distance between points. Questions to consider include: How far apart should your points be? How long should you collect data at each location?</li>
</ul></li>
<li>Here is a list of suggested locations. Quyên and I will circulate among the groups.
<ul>
<li>Pomona College Organic Farm / 1st street</li>
<li>Marston Quad and College Avenue</li>
<li>Foothill Avenue and College Avenue</li>
<li>Former gymnasium and active construction site near 6th and Amherst.</li>
</ul></li>
<li>As an initial exercise, we will allocate up to 1 hour collecting data.
<ul>
<li>In that time, I would recommend performing <strong>replicates</strong> of your transects.</li>
<li>I would recommend taking data at stationary <em>points</em> at different <em>distances</em> for instance to your site of interest. (Consider how the different sites could vary in terms of air quality.)</li>
</ul></li>
<li>The mobile application <code>Google Earth</code> can be used to determine your distance to a point of interest.</li>
</ul>
</div>
<div id="enhancing-the-community-guidelines-document" class="section level2">
<h2>Enhancing the community guidelines document</h2>
<p>Before we revisit the community guidelines document, please read this article in <a href="https://smallpondscience.com/2017/07/10/safety-in-the-field/">Small Pond Science</a> (content warning: references sexual assault) and this <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1890/0012-9623-95.3.264">Bulletin of the Ecological Society of America</a> article (please pay special attention to Table 1).</p>
<p>Here are some guiding questions to consider. There are additional questions that we can and should consider as a group! Please share them, and if you are uncomfortable sharing them directly, you are welcome to anonymously pose the question in the Google doc.</p>
<ul>
<li>When and where does working in teams or small groups enhance field safety? When might working in teams or small groups be less than ideal for safety?</li>
<li>What are the signs of physical or emotional distress? How can we support and look out for one another?</li>
<li>When and where can technology facilitate safety? When and where might technology undermine field safety?</li>
<li>What are examples of conditions that are unsafe in the field? How can we avoid them? How can we look out for one another with respect to avoiding these conditions or dealing with these conditions constructively?
<ul>
<li>One example could be contact with a <a href="https://www.cdc.gov/niosh/topics/plants/symptoms.html">poisonous plant such as poison oak</a>.</li>
<li>Another could be a confrontation with another person, which could be driven by larger systemic biases.</li>
<li>Finally, conditions such as uneven terrain or very open locations with no tree cover could pose issues in this time of year (or in general).</li>
</ul></li>
<li>What are best practices for communicating our comfort or discomfort in the field?</li>
<li>What are the potential physical, emotional, or other barriers to participating in different forms of field work or field work in different types of locations?</li>
</ul>
</div>
<div id="developing-your-group-project" class="section level2">
<h2>Developing your group project</h2>
<p>For this laboratory project, you will have several decisions to make:</p>
<ul>
<li>What question do we seek to explore with PL Air data? What variable(s) are we particularly interested in?</li>
<li>What is an appropriate distance between sampling points?</li>
<li>What, if any, sources or locations do we seek to sample?</li>
<li>How long should we remain at each point to collect the data?</li>
<li>How many replicates should we take of our data? In this context, replicates could mean the combination of <em>distance to a location/source</em>, <em>time duration</em>, and <em>variable measured</em> if these are variables of interest to your group.</li>
</ul>
<p>This resource from the <a href="https://www.rgs.org/schools/teaching-resources/sampling-techniques/">Royal Geographical Society</a> may provide additional insight into designing your transects.</p>
<div id="a-note-on-replicating-data" class="section level3">
<h3>A note on replicating data</h3>
<p>How might you replicate data collection to try and account for uncertainty in individual estimates? Generally there are two broad ways to achieve this: spatial replication and temporal replication. In working with your groups, please discuss the salient variables that could affect your question (e.g. distance to a road or a construction site for pollutants, tree cover for a heat island effect, and time of day). You can then develop a plan to collect data.</p>
</div>
<div id="additional-air-pollution-information" class="section level3">
<h3>Additional air pollution information</h3>
<p>Note that the PL Air units report AQI, PM 2.5, PM 10, and O3 data. You can toggle back to the previous week’s Air Quality page to see Myriad Sensors’ (PL Air company) description of how these values are estimated. However, if, for instance, you are interested in the raw values of PM 2.5 that are reported, you may wonder how these values are converted to and from AQI scores. You can navigate to <a href="https://www.airnow.gov/aqi/aqi-calculator-concentration/">this AirNow calculator</a> to see how your data maps to AQI. If you would like to see the interpretation of AQI values, please check out <a href="https://www.airnow.gov/aqi/aqi-basics/">this AirNow explainer site</a>. Note - researchers are still developing ways to take the much more instantaneous data we observe on the PL Air and other sensors to “instant exposure” AQI scales. For now though we can use the 24-hour averages for PM and submit the observed data to see that mapping play out (between <span class="math inline">\(\mu g/m^3\)</span> to AQI scores).</p>
</div>
</div>
</div>
<div id="analyzing-pocketlab-air-data" class="section level1">
<h1>Analyzing PocketLab Air data</h1>
<p>This component of the laboratory may be pushed to a later date if time does not permit in lab. In general, one straightforward way to interact with the PL Air <code>.CSV</code> data is to use Google Sheets. The first thing we need to do though is authorize access to our Google accounts in RStudio Server.</p>
<div id="authorizing-access-to-google-sheets-with-the-googlesheets4-package-in-r" class="section level2">
<h2>Authorizing access to Google sheets with the <code>googlesheets4</code> package in <code>R</code></h2>
<p>This workflow also only needs to be done <strong>ONCE</strong>. The first time you interact with a Google sheet using the <code>googlesheets4</code> Application Programming Interface (API) wrapper, it will ask you about permissions to store your credentials (account information). You can run these commands in the console.</p>
<p>The workflow is below:</p>
<ol style="list-style-type: decimal">
<li>Read in an example Google sheet, which will launch an initial query about what Google account you’d like to associate with the package:</li>
</ol>
<pre class="r"><code>library(googlesheets4) # load the Googlesheets4 package</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Now we are going to use <code>Googlesheets4</code> to try and pull in a sheet. This will prompt you to grant access to your Google account the first time you run this code.</li>
</ol>
<pre class="r"><code>options(gargle_oob_default = TRUE) # this sets up an option for you to authenticate in your local browser rather than through the RStudio Server, which does not permit certain communication protocols
enviro_soc_media_DF &lt;- googlesheets4::read_sheet(&quot;https://docs.google.com/spreadsheets/d/1hQy8kR81GHmMDPivpyd8XzAGU7A6oUCUArq1bltm5EQ/edit?usp=sharing&quot;) # initiate the Google credential query by calling for a shared sheet</code></pre>
<p>You will then see the console print out:</p>
<pre><code>Is it OK to cache OAuth access credentials in the folder
/home/CAMPUS/your_user_ID/.cache/gargle between R sessions?

1: Yes
2: No

Selection:</code></pre>
<p>Type <code>1</code> into the <code>Selection:</code> prompt.</p>
<ol start="3" style="list-style-type: decimal">
<li>At the same time, another tab will open in your internet browser on your computer, displaying a window that asks you to select which of your Google account(s) to grant access to in <code>RStudio Server</code> using the <code>googlesheets4</code> package.</li>
</ol>
<p><img src="figures/grantTidyverse.png" /></p>
<p>Select <code>Allow</code>. Next, you will see:</p>
<p><img src="figures/permissions.png" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Select <code>Allow</code> again. This will produce an authorization code that you will then copy and paste into your <code>RStudio</code> session. You can copy the code by pressing the <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"/></svg> button to the right of the authentication code.</li>
</ol>
<p><img src="figures/RStudioOAuthCopyCode.png" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Next, navigate back to the internet browser tab running <code>RStudio Server</code>. You will paste the code in response to the <code>Enter authorization code</code> prompt waiting in the console.</li>
</ol>
<p><img src="figures/RStudioServerInitAuth.png" /> 6. Paste the authorization code into the blank space next to <code>Enter authorization code</code>.</p>
<ol start="7" style="list-style-type: decimal">
<li>Once you paste the authorization code in, you will see this type of successful response, showing you that the authentication has worked and the <code>read_sheet</code> function <code>googlesheets4</code> will return:</li>
</ol>
<p><img src="figures/RStudioServerCopiedAuthKey.png" /></p>
<ol start="8" style="list-style-type: decimal">
<li><p>Great work! You have successfully authenticated access to your Google account in your <code>RStudio Server</code> user workspace.</p></li>
<li><p>Going forward, even if you switch sessions, restart your session, or open a new session in <code>RStudio Server</code>, you shouldn’t need to re-authenticate access to Google. Instead, your credentials will be stored in a cached file. It may ask you though if you want to use a particular “credential” (basically an account) - usually you would type <code>1</code> for the first account listed.</p></li>
</ol>
</div>
<div id="interacting-with-pocketlab-air-data-as-a-google-sheet" class="section level2">
<h2>Interacting with PocketLab Air data as a Google sheet</h2>
<div id="android-data" class="section level3">
<h3>Android data</h3>
<pre class="r"><code>library(googlesheets4)
library(dplyr)

### Here we are pulling in the Google Sheets data from team Paprika
airDF &lt;- googlesheets4::read_sheet(&quot;https://docs.google.com/spreadsheets/d/14l_xiqddGl2IFpOPsjfCSSLaHLVeunBhsToimXFuPrA/edit?usp=sharing&quot;) # here, we&#39;re saying - go to this URL, pull in the Googlesheet, then store it in an object called airDF

### We can see what our data looks like by calling airDF in the console
airDF # yay!

### If we wanted to see what the average PM value was across the trial, we could, for instance, run
mean(airDF$`Particulate Matter-PM2.5 (ug/m&amp;#179;)`)

### We can also see more information about the variable - min, max, and some quartiles.
summary(airDF$`Particulate Matter-PM2.5 (ug/m&amp;#179;)`)

### We can repeat this for the more smoothed-out values of the 10-minute averaged PM 2.5 data
mean(airDF$`Particulate Matter-10 Min. Avg. PM2.5 (ug/m&amp;#179;)`)
summary(airDF$`Particulate Matter-10 Min. Avg. PM2.5 (ug/m&amp;#179;)`)</code></pre>
</div>
<div id="ios-data" class="section level3">
<h3>iOS data</h3>
<p>One issue with the <code>iOS</code> data is that the mobile application splinches the spreadsheet data. Typically, we would expect to see all of the data in a tidy set of columns, where each row is a particular time point. However, the <code>iOS</code> PocketLab application basically creates a new mini-spreadsheet for each sensor.</p>
<p>Below are the URLs for all of the <code>iOS</code> groups.</p>
<ul>
<li>Fresno: “<a href="https://docs.google.com/spreadsheets/d/15l8zplAYiLu6kmqPqo0kExe5Ww3RPeSTMlkfv2XoMDc/edit?usp=sharing" class="uri">https://docs.google.com/spreadsheets/d/15l8zplAYiLu6kmqPqo0kExe5Ww3RPeSTMlkfv2XoMDc/edit?usp=sharing</a>”</li>
<li>Aji: “<a href="https://docs.google.com/spreadsheets/d/1Q9sm9IokCP0lba-ZcBGXG2YkkSOyhRSw-4ijbs1HU-s/edit?usp=sharing" class="uri">https://docs.google.com/spreadsheets/d/1Q9sm9IokCP0lba-ZcBGXG2YkkSOyhRSw-4ijbs1HU-s/edit?usp=sharing</a>”</li>
<li>Shishito: “<a href="https://docs.google.com/spreadsheets/d/17KYbZqLEirxh2cAr6dOlIBJhKo5LWPuvq3dgDPZ-NHA/edit?usp=sharing" class="uri">https://docs.google.com/spreadsheets/d/17KYbZqLEirxh2cAr6dOlIBJhKo5LWPuvq3dgDPZ-NHA/edit?usp=sharing</a>”</li>
<li>Bird’s Eye: “<a href="https://docs.google.com/spreadsheets/d/1QX5ESRLnq3hjeWAPinquTvK9RELK0cMvIEAjBxhG_6Q/edit?usp=sharing" class="uri">https://docs.google.com/spreadsheets/d/1QX5ESRLnq3hjeWAPinquTvK9RELK0cMvIEAjBxhG_6Q/edit?usp=sharing</a>”</li>
</ul>
<p>You can copy and paste this code to run it in the console in <code>RStudio Server</code> to clean up your own data. <strong>Note: these steps are only necessary if you have data that was collected using an iPhone</strong>.</p>
<pre class="r"><code>library(googlesheets4)
library(dplyr)

### Provide a URL
  # This URL is for Team Scorpion
gs_url &lt;- &quot;https://docs.google.com/spreadsheets/d/1gn6A3uht6e9iQ3qCmqGUTFRhP6YZLdejt5yYjhzeQks/edit?usp=sharing&quot;

### Here, we are pulling in Google Sheets data from team Scorpion
airDF &lt;- googlesheets4::read_sheet(gs_url,sheet=1) # we are storing the default file read in as airDF</code></pre>
<p>When you run the lines above (<code>airDF &lt;- ...</code>) you may see this message from <code>googlesheets4</code>:</p>
<pre><code>The googlesheets4 package is requesting access to your Google account. Select a pre-authorised account or enter &#39;0&#39; to obtain a new token. Press Esc/Ctrl + C to abort.

1: yourEmail@gmail.com

Selection: </code></pre>
<p>Type <code>1</code> next to <code>Selection:</code> and hit enter, then you can proceed.</p>
<pre class="r"><code>### Reading in the same data, but in a more structured way
airDF_struct &lt;- googlesheets4::read_sheet(gs_url,sheet=1,col_types=&quot;nntnnnnnnnn&quot;) # here I am reading in the same file but specifying the data types in the column (number or time-stamp) and storing it in a different object called airDF_struct

### What happens when we type airDF in the console?
airDF # cool! We see a subset of our data displayed

### We are going to pull in several helper functions
### using the command &quot;source&quot;
### FMI: ?source
source(&quot;https://raw.githubusercontent.com/EA30POM/Fall2021/main/helpers/CleanPLiOS.R&quot;) # you only need to run this code once per session

### Using a helper function to clean up our iOS Air Data
airCleanDF &lt;- cleanup_air_function(airDF,airDF_struct)

### Viewing our clean data
airCleanDF %&gt;%
  head()  %&gt;% # view first 6 rows
  View() # pop up an Excel-like data viewer.

### Saving the clean data:
### Option 1: Add a new sheet to your Google Sheet with the clean data
googlesheets4::write_sheet(airCleanDF, ss=gs_url, sheet=&quot;Clean&quot;) # this will create a new sheet called &quot;Clean&quot; for the clean data.
    # Then you can go into the Google Sheet to download the CSV file and upload that to the PL Notebook site.

### Option 2: Saving it as a CSV file
### You will then need to download the file to your own
### computer use it.
readr::write_csv(airCleanDF,file=&quot;~/PLAirDataClean.csv&quot;)</code></pre>
<p>In the last segment of the code above, you might notice something interesting looking: this <code>%&gt;%</code> pipe operator. The pipe operator <code>%&gt;%</code> lets you daisy chain commands together into a sequence. It is a handy way to make a complex operation with intermediate steps more transparent. The visualization below describes what pipes do in <code>R</code> in linking up functions:</p>
<div class="figure">
<img src="figures/Rpipeoperator.png" alt="" />
<p class="caption">Schematic of the pipe <code>%&gt;%</code> operator in <code>R</code> (Altaf Ali)</p>
</div>
<p>Now that we finally have clean data (yay!) we can calculate the same types of summary statistics.</p>
<pre class="r"><code>### Calculating the mean and summary statistics for PM data
mean(airCleanDF$`PM2.5 (µg/m³)`)
summary(airCleanDF$`PM2.5 (µg/m³)`) # note that the variable names are a bit different from the Android ones

### We can also repeat this for the smoother averaged values
mean(airCleanDF$`Mean PM2.5 (µg/m³)`)
summary(airCleanDF$`Mean PM2.5 (µg/m³)`)</code></pre>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
