<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2021-11-16" />

<title>Week 12</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Environmental Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data science
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 1</li>
    <li>
      <a href="Rintro.html">The R and RStudio environments</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Climate science
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 1</li>
    <li>
      <a href="AQintro.html">Air Quality Lab Introduction</a>
    </li>
    <li class="dropdown-header">Week 2</li>
    <li>
      <a href="AQexp1.html">Air Quality: Test transects</a>
    </li>
    <li class="dropdown-header">Week 3</li>
    <li>
      <a href="AQexp2.html">Air Quality: Analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Soil science
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="soil.html">Analyzing data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Environmental communications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="EnvComm1.html">Visualization</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Week 12</h1>
<h4 class="author"></h4>
<h4 class="date">2021-11-16</h4>

</div>


<div id="overview" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Overview</h1>
<p>We will be:</p>
<ol style="list-style-type: decimal">
<li>importing the class data for biodiversity media coverage;</li>
<li>seeing how to subset or summarize these data;</li>
<li>perform different visualizations of the data.</li>
</ol>
<p>You are welcome to either follow along with the text and copy-paste the code into the console <strong>or</strong> read through and then copy the whole script into a new <code>R</code> script in <a href="https://rstudio.cloud/spaces/170230/project/3241288">Rstudio.Cloud Enviro Comms Lab</a>. <strong>Please make sure that you start a new project using that link.</strong> Do <strong>not</strong> continue using the projects from the Air Quality Lab or the Soil Science Lab.</p>
<div id="loading-packages" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Loading packages</h2>
<p>First, let’s make sure we have useful functions to help us in this project.</p>
<pre class="r"><code>## Libraries for interacting with data
library(readr) # reads in spreadsheet data
library(dplyr) # lets you wrangle data more effectively

## Libraries for plotting
library(ggplot2) # plotting library
library(waffle)  # square pie chart (waffle chart) library

## Libraries for spatial data
library(sf)       # a nicer way to deal with spatial data
library(spData)   # spatial datasets

## Libraries for text data
library(vader) # package that permits for sentiment analysis
library(tidytext) # package for wrangling text data
library(stringr) # package with helpful functions dealing with string, or character/text data.
library(tokenizers) # package to split strings into smaller entities (e.g. messages into words, ngrams, or individual letters)</code></pre>
</div>
<div id="importing-the-class-dataset" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> Importing the class dataset</h2>
<p>Next, we’re going to import the class dataset.</p>
<pre class="r"><code>CSPdf &lt;- read_tsv(&quot;https://raw.githubusercontent.com/EA30POM/Fall2021/main/data/OTEC_CSP.tsv&quot;) # use the function read_tsv from readr to pull in a spreadsheet from this URL.
    # Then store the output in an object called &quot;CSPdf&quot;
    # CSPdf stands for Conservation Science Partners data frame</code></pre>
<p>We can always pull up a viewer of our data by using these commands:</p>
<pre><code>## Version 1:
CSPdf %&gt;% # take CSPdf and feed it into the next command
    head( ) %&gt;% # look at the first 6 rows
      View( ) # open the spreadsheet viewer
      # akin to x --&gt; f(x) --&gt; g(x)
      
## Alternatively, version 2:
View( head( CSPdf ) ) # akin to g( f( x ) )</code></pre>
</div>
<div id="some-simple-summaries-of-the-data" class="section level2" number="1.3">
<h2 number="1.3"><span class="header-section-number">1.3</span> Some simple summaries of the data</h2>
<p>What topics are in the data?</p>
<pre class="r"><code>CSPdf %&gt;%  # feed CSPdf into the next command
  group_by(Topic) %&gt;% # bucket the data based on the Topics of each article
  summarise(Count = n()) # get the counts across all of the articles for every topic</code></pre>
<pre><code>## # A tibble: 12 x 2
##    Topic          Count
##    &lt;chr&gt;          &lt;int&gt;
##  1 Climate Change     8
##  2 Conservation     171
##  3 Ecotourism        39
##  4 Exploitation     200
##  5 Habitat Loss      12
##  6 Health            57
##  7 HWI              185
##  8 PAs               40
##  9 Pollution         10
## 10 Threats           65
## 11 Wildlife info    158
## 12 Zoo               26</code></pre>
<pre class="r"><code>## How much data do we have?
dim(CSPdf) # displays number of rows and columns</code></pre>
<pre><code>## [1] 971   9</code></pre>
<pre class="r"><code>nrow(CSPdf) # displays number of row</code></pre>
<pre><code>## [1] 971</code></pre>
<p><em>Questions</em>:</p>
<ul>
<li>How would I modify this code to get the counts for <code>Portrayals</code>?</li>
<li>How would I modify this code to get the counts for <code>Country</code>?</li>
<li>How would I modify this code to get the counts for <code>Taxon</code>?</li>
</ul>
<div id="topic-fields" class="section level3" number="1.3.1">
<h3 number="1.3.1"><span class="header-section-number">1.3.1</span> Topic fields</h3>
<ul>
<li>Exploitation: Humans are either illegally or legally hunting, fishing, or harvesting the species</li>
<li>HWI: Human-wildlife interaction, ranging from sightings to conflict</li>
<li>PAs: Protected areas</li>
<li>Wildlife info: Information about species ranging from their natural history to scientific findings</li>
<li>Threats: Broad threats to biodiversity</li>
<li>Pollution: Impacts or concerns about pollution on species</li>
<li>Conservation: Conservation actions or ideas for protecting species</li>
<li>Health: Species as a disease source or otherwise interacting with human health</li>
<li>Zoo: Zoo animal media coverage</li>
<li>Habitat Loss</li>
<li>Ecotourism</li>
<li>Climate Change</li>
</ul>
</div>
</div>
</div>
<div id="focusing-on-a-particular-taxon" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Focusing on a particular taxon</h1>
<p>Let’s say that my group decides to focus on wolves. How do I filter the data to just look at wolves?</p>
<p>Easy! I can use the <code>filter</code> function from the <code>dplyr</code> package.</p>
<pre class="r"><code>subDF &lt;- CSPdf %&gt;% # take CSPdf and feed it forward into
  filter(Taxon==&quot;wolf&quot;)  # the filter function, selecting only for the rows where Taxon is equal to wolf
  # and assign the output to subDF, short for subset data frame</code></pre>
<p><em>Questions</em>:</p>
<ul>
<li>How would I modify this code to focus just on <code>deer</code>?</li>
<li>How would I modify this code to focus on articles that look at <code>Exploitation</code> but include all of the species?</li>
<li>How would I modify this code to focus on articles that came out in the United States and portray species as <code>Vulnerable</code>?</li>
</ul>
</div>
<div id="example-analyses" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Example analyses</h1>
<p>Below, we’ll walk through some example visualizations.</p>
<div id="summaries-for-variables" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Summaries for variables</h2>
<p>Now that we’ve subset our data, how can we get helpful information about different variables?</p>
<pre class="r"><code>summaryDF &lt;- subDF %&gt;% # take the subset data, subDF, and feed it into
  group_by(Topic) %&gt;% # a grouping operation to bucket the data based on topic
  summarise(Count=n()) # then get the count of articles by topic</code></pre>
<p><em>Questions:</em></p>
<ul>
<li>How would I modify this code to get the count of articles about wolves by <code>Country</code>?</li>
<li>How would I modify the code to get the <code>min</code>imum or <code>mean</code> value for <code>Sentiment</code> for articles about wolves?</li>
</ul>
<p>We can use a square pie chart, aka a waffle chart, to display this information about the topic by topic breakdown for wolf articles.</p>
<pre class="r"><code>names(summaryDF) &lt;- c(&quot;name&quot;,&quot;vals&quot;) # changing column names for the summaryDF object
col_ramp &lt;- RColorBrewer::brewer.pal(nrow(summaryDF), &quot;Set3&quot;) # selecting a nicer set of colors
waffle(data.frame(summaryDF),colors=col_ramp) # create a waffle plot for the summaryDF object, with the color ramp we have</code></pre>
<p><img src="EnvComm1_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p><em>Questions:</em></p>
<ul>
<li>How would I modify the code above to generate this same type of plot for <code>Country</code> counts for wolves instead?</li>
<li>Is this type of plot appropriate for a variable like <code>Sentiment</code>?</li>
</ul>
</div>
<div id="what-is-the-relationship-between-portrayals-and-topics-for-wolves" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> What is the relationship between portrayals and topics for wolves?</h2>
<p>This is a type of analysis that is called a <a href="https://www.qualtrics.com/experience-management/research/cross-tabulation/">“cross-tabulation”</a>, or crosstab for short. Every entry in a crosstab table tells you the <strong>number of observations</strong> that have some specific pairing of variables. For example, how many articles about wolves have the portrayal <code>Vulnerable</code> with the topic <code>Exploitation</code>?</p>
<pre class="r"><code>crossDF &lt;- subDF %&gt;% # start from our subset data, subDF
  group_by(Topic,Portrayal) %&gt;% # bucket the data based on Topic and Portrayal
  summarise(Count=n()) # get the counts for each combination of Topic and Portrayal
  # save the output in the object crossDF (short for crosstab data frame)</code></pre>
<p><em>Questions</em>:</p>
<ul>
<li>How would I modify this code to create a cross-tab for <code>Country</code> and <code>Topic</code>?</li>
<li>How would I modify this code to create a cross-tab for <code>Portrayal</code> and <code>Country</code>?</li>
<li>Would it make sense to create cross-tabs for <code>Sentiment</code> and <code>Country</code>?</li>
</ul>
<p>Now we can visualize our crosstab.</p>
<pre class="r"><code>p &lt;- ggplot(crossDF, aes(Topic, Portrayal, Count)) # initiate a plot using crossDF
p &lt;- p + geom_point(aes(size = Count), colour = &quot;skyblue&quot;) # plot points for each combination of topic and portrayal - change the size of the point based on the counts
p &lt;- p + theme_bw() + labs(x=&quot;&quot;,y=&quot;&quot;,size=&quot;Count:&quot;) # modify the plot appearnace
p &lt;- p + scale_size_continuous(range=c(1,10)) + geom_text(aes(label = Count)) # change the range of the point sizes and add text information about the crosstabs
p &lt;- p + theme(axis.text.x = element_text(angle = 45, hjust=1),
               legend.position = &quot;top&quot;) # change the plot visualization
p # display the plot</code></pre>
<p><img src="EnvComm1_files/figure-html/ctab_viz-1.png" width="672" /></p>
<p><em>Questions</em>:</p>
<ul>
<li>How would I modify this code for the other cross-tabs above?</li>
</ul>
</div>
<div id="visualizing-the-distribution-of-sentiment" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> Visualizing the distribution of sentiment</h2>
<p>What is the distribution of sentiment toward wolves?</p>
<pre class="r"><code>p &lt;- ggplot(data=subDF, aes(x=Sentiment)) # create a plot from the subDF object using the column Sentiment
p &lt;- p + geom_histogram() # add a histogram to the plot
p &lt;- p + theme_classic() # change the display of the plot
p &lt;- p + labs(y=&quot;Count&quot;) # change the y-axis label
p # display the plot</code></pre>
<p><img src="EnvComm1_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>How does sentiment vary across topics for wolves?</p>
<pre class="r"><code>p &lt;- ggplot(data=subDF, aes(x=Topic,y=Sentiment)) # create a plot using the columns Topic and Sentiment from the subDF data
p &lt;- p + geom_boxplot() # add a boxplot
p &lt;- p + geom_hline(yintercept=0, linetype=&quot;dashed&quot;, col=&quot;red&quot;) # add a red dahsed line to demarcate where the positive vs. negative articles are located
p &lt;- p + coord_flip() # switch the x- and y-axis
p # display plot</code></pre>
<p><img src="EnvComm1_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="visualizing-the-distribution-of-articles-across-countries" class="section level2" number="3.4">
<h2 number="3.4"><span class="header-section-number">3.4</span> Visualizing the distribution of articles across countries</h2>
<p>Below, we are going to do several things:</p>
<ul>
<li>pull in a dataset that has spatial attributes for all countries</li>
</ul>
<pre class="r"><code>worldDF &lt;- world # store the dataset for the world in worldDF, world data frame</code></pre>
<ul>
<li>get counts by country for wolf articles</li>
</ul>
<pre class="r"><code>speciesCountryCounts &lt;- subDF %&gt;% # feed the subsetDF forward
  group_by(Country) %&gt;% # bucket based on country
  summarise(Count=n()) # get counts by country</code></pre>
<ul>
<li>add on the counts for each country for the wolf articles</li>
</ul>
<pre class="r"><code>speciesMap &lt;- worldDF %&gt;% # take the worldDF object and feed forward
  left_join(speciesCountryCounts, by=c(&quot;name_long&quot;=&quot;Country&quot;)) # combine with our count data by country, 
  # getting the data to match on the columns &quot;name_long&quot; (countries) and &quot;Country&quot;
  # store outputs in speciesMap</code></pre>
<ul>
<li>plot the world’s countries with colors given by article count</li>
</ul>
<pre class="r"><code>p &lt;- ggplot(data=speciesMap, aes(fill=Count)) # use the speciesMap object to create a map
p &lt;- p + geom_sf(aes(fill=Count),color=&quot;gray47&quot;,size=0.05) # add on the boundaries of countries
p &lt;- p + labs(x=&quot;&quot;,y=&quot;&quot;,fill=&quot;Count of wolf articles: &quot;) # change the names of the variables as needed 
p &lt;- p + theme_minimal() # change the display style
p &lt;- p + theme(legend.position = &quot;top&quot;) # move the legend bar to the top
p # display the plot</code></pre>
<p><img src="EnvComm1_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="visualizing-sentiment-across-different-countries" class="section level2" number="3.5">
<h2 number="3.5"><span class="header-section-number">3.5</span> Visualizing sentiment across different countries</h2>
<p>How would we visualize the distribution of sentiment for wolf media coverage across countries?</p>
<p>First, we probably want to make our lives easier but just focusing on the countries that have more wolf coverage.</p>
<pre class="r"><code>subDF %&gt;% # take subDF and feed forward into
  group_by(Country) %&gt;% # a grouping step to bucket by Country
  summarise(Count=n()) # then get the count of coverage by country</code></pre>
<pre><code>## # A tibble: 9 x 2
##   Country        Count
##   &lt;chr&gt;          &lt;int&gt;
## 1 Canada             7
## 2 India              2
## 3 Ireland            2
## 4 New Zealand        2
## 5 Russia             2
## 6 South Africa       1
## 7 Switzerland        1
## 8 United Kingdom    14
## 9 United States    133</code></pre>
<p>Next, we’re going to further subset the data to just the few countries that have more articles on wolves.</p>
<pre class="r"><code>subCountryDF &lt;- subDF %&gt;% # take subDF
  filter(Country==&quot;United States&quot; | 
         Country==&quot;United Kingdom&quot; |
         Country==&quot;Canada&quot;) # only keep the articles that are coming from the US, Canada, or the UK
  # This | vertical bar is the same as saying OR
  # Save the output in subCountryDF</code></pre>
<p>Finally, we can make a plot of sentiment across countries for wolves.</p>
<pre class="r"><code>p &lt;- ggplot(data=subCountryDF, aes(x=Country,y=Sentiment)) # use the subCountryDF object to initiate a plot of country and sentiment
p &lt;- p + geom_boxplot() # add on a boxplot
p &lt;- p + geom_hline(yintercept=0, linetype=&quot;dashed&quot;, col=&quot;red&quot;) # add a red dahsed line to demarcate where the positive vs. negative articles are located
p &lt;- p + coord_flip() # switch the x and y-axis
p # display plot</code></pre>
<p><img src="EnvComm1_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="code-in-entirety" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Code in entirety</h1>
<p>The code below can be copied and pasted into RStudio Cloud for running directly.</p>
<pre class="r"><code>###==============================
### Loading packages
###==============================

## Libraries for interacting with data
library(readr) # reads in spreadsheet data
library(dplyr) # lets you wrangle data more effectively

## Libraries for plotting
library(ggplot2) # plotting library
library(waffle)  # square pie chart (waffle chart) library

## Libraries for spatial data
library(sf)       # a nicer way to deal with spatial data
library(spData)   # spatial datasets

## Libraries for text data
library(vader) # package that permits for sentiment analysis
library(tidytext) # package for wrangling text data
library(stringr) # package with helpful functions dealing with string, or character/text data.
library(tokenizers) # package to split strings into smaller entities (e.g. messages into words, ngrams, or individual letters)

###==============================
### Reading in the data
###==============================

CSPdf &lt;- read_tsv(&quot;https://raw.githubusercontent.com/EA30POM/Fall2021/main/data/OTEC_CSP.tsv&quot;) # use the function read_tsv from readr to pull in a spreadsheet from this URL.
    # Then store the output in an object called &quot;CSPdf&quot;
    # CSPdf stands for Conservation Science Partners data frame

## Inspecting the data, version 1:
CSPdf %&gt;% # take CSPdf and feed it into the next command
    head( ) %&gt;% # look at the first 6 rows
      View( ) # open the spreadsheet viewer
      # akin to x --&gt; f(x) --&gt; g(x)
      
## Alternatively, version 2:
View( head( CSPdf ) ) # akin to g( f( x ) )

###==============================
### Data summaries
###==============================

CSPdf %&gt;%  # feed CSPdf into the next command
  group_by(Topic) %&gt;% # bucket the data based on the Topics of each article
  summarise(Count = n()) # get the counts across all of the articles for every topic

###==============================
### Subsetting the data
###==============================

subDF &lt;- CSPdf %&gt;% # take CSPdf and feed it forward into
  filter(Taxon==&quot;wolf&quot;)  # the filter function, selecting only for the rows where Taxon is equal to wolf
  # and assign the output to subDF, short for subset data frame

###==============================
### Summarizing the subset
###==============================

summaryDF &lt;- subDF %&gt;% # take the subset data, subDF, and feed it into
  group_by(Topic) %&gt;% # a grouping operation to bucket the data based on topic
  summarise(Count=n()) # then get the count of articles by topic

###==============================
### Visualizing the distro
### of categories in the data
###==============================

names(summaryDF) &lt;- c(&quot;name&quot;,&quot;vals&quot;) # changing column names for the summaryDF object
col_ramp &lt;- RColorBrewer::brewer.pal(nrow(summaryDF), &quot;Set3&quot;) # selecting a nicer set of colors
waffle(data.frame(summaryDF),colors=col_ramp) # create a waffle plot for the summaryDF object, with the color ramp we have

###==============================
### Crosstabs
###==============================

crossDF &lt;- subDF %&gt;% # start from our subset data, subDF
  group_by(Topic,Portrayal) %&gt;% # bucket the data based on Topic and Portrayal
  summarise(Count=n()) # get the counts for each combination of Topic and Portrayal
  # save the output in the object crossDF (short for crosstab data frame)

  ## Visualization of crosstabs
p &lt;- ggplot(crossDF, aes(Topic, Portrayal, Count)) # initiate a plot using crossDF
p &lt;- p + geom_point(aes(size = Count), colour = &quot;skyblue&quot;) # plot points for each combination of topic and portrayal - change the size of the point based on the counts
p &lt;- p + theme_bw() + labs(x=&quot;&quot;,y=&quot;&quot;,size=&quot;Count:&quot;) # modify the plot appearnace
p &lt;- p + scale_size_continuous(range=c(1,10)) + geom_text(aes(label = Count)) # change the range of the point sizes and add text information about the crosstabs
p &lt;- p + theme(axis.text.x = element_text(angle = 45, hjust=1),
               legend.position = &quot;top&quot;) # change the plot visualization
p # display the plot

###==============================
### Visualizing a numeric
### variable like sentiment
###==============================

p &lt;- ggplot(data=subDF, aes(x=Sentiment)) # create a plot from the subDF object using the column Sentiment
p &lt;- p + geom_histogram() # add a histogram to the plot
p &lt;- p + theme_classic() # change the display of the plot
p &lt;- p + labs(y=&quot;Count&quot;) # change the y-axis label
p # display the plot

p &lt;- ggplot(data=subDF, aes(x=Topic,y=Sentiment)) # create a plot using the columns Topic and Sentiment from the subDF data
p &lt;- p + geom_boxplot() # add a boxplot
p &lt;- p + geom_hline(yintercept=0, linetype=&quot;dashed&quot;, col=&quot;red&quot;) # add a red dahsed line to demarcate where the positive vs. negative articles are located
p &lt;- p + coord_flip() # switch the x- and y-axis
p # display plot

###==============================
### Visualizing the distro
### of articles across countries
###==============================

worldDF &lt;- world # store the dataset for the world in worldDF, world data frame

speciesCountryCounts &lt;- subDF %&gt;% # feed the subsetDF forward
  group_by(Country) %&gt;% # bucket based on country
  summarise(Count=n()) # get counts by country

speciesMap &lt;- worldDF %&gt;% # take the worldDF object and feed forward
  left_join(speciesCountryCounts, by=c(&quot;name_long&quot;=&quot;Country&quot;)) # combine with our count data by country, 
  # getting the data to match on the columns &quot;name_long&quot; (countries) and &quot;Country&quot;
  # store outputs in speciesMap
  
  ## Create plot
p &lt;- ggplot(data=speciesMap, aes(fill=Count)) # use the speciesMap object to create a map
p &lt;- p + geom_sf(aes(fill=Count),color=&quot;gray47&quot;,size=0.05) # add on the boundaries of countries
p &lt;- p + labs(x=&quot;&quot;,y=&quot;&quot;,fill=&quot;Count of wolf articles: &quot;) # change the names of the variables as needed 
p &lt;- p + theme_minimal() # change the display style
p &lt;- p + theme(legend.position = &quot;top&quot;) # move the legend bar to the top
p # display the plot

###==============================
### Visualizing the distro
### of sentiment across countries
###==============================

subDF %&gt;% # take subDF and feed forward into
  group_by(Country) %&gt;% # a grouping step to bucket by Country
  summarise(Count=n()) # then get the count of coverage by country

  ## subset to the countries with the most articles
subCountryDF &lt;- subDF %&gt;% # take subDF
  filter(Country==&quot;United States&quot; | 
         Country==&quot;United Kingdom&quot; |
         Country==&quot;Canada&quot;) # only keep the articles that are coming from the US, Canada, or the UK
  # This | vertical bar is the same as saying OR

p &lt;- ggplot(data=subCountryDF, aes(x=Country,y=Sentiment)) # use the subCountryDF object to initiate a plot of country and sentiment
p &lt;- p + geom_boxplot() # add on a boxplot
p &lt;- p + geom_hline(yintercept=0, linetype=&quot;dashed&quot;, col=&quot;red&quot;) # add a red dahsed line to demarcate where the positive vs. negative articles are located
p &lt;- p + coord_flip() # switch the x and y-axis
p # display plot
  # Save the output in subCountryDF</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
